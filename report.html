<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project Report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="polls_clean.html">Poll Data</a>
</li>
<li>
  <a href="election_result.html">Election Results Data</a>
</li>
<li>
  <a href="tweet_clean.html">Twitter Data</a>
</li>
<li>
  <a href="wc_redirect.html">Word Cloud</a>
</li>
<li>
  <a href="comparison_over_datasets.html">Comparison over datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="report.html">Project Report</a>
</li>
<li>
  <a href="link to screencast">
    <span class="fa fa-youtube-play fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Project Report</h1>

</div>


<div id="tweet-data" class="section level3">
<h3>Tweet Data</h3>
<p>We opted to use the two datasets found <a href="https://www.kaggle.com/manchunhui/us-election-2020-tweets">here</a> constructed from scraping Twitter for tweets either containing <em>#Biden</em> (or <em>#JoeBiden</em>) or containing <em>#Trump</em> (or <em>#DonaldTrump</em>) from Oct 15th through Nov 8th.</p>
<p>Because the datasets were large we droped missing data and divided each dataset into two subsets to be able to store them within our repository.</p>
<pre class="r"><code>read_csv(&quot;./datasets/hashtag_donaldtrump.csv&quot;) %&gt;% 
  drop_na() %&gt;%
  slice(seq(0.5 * n())) %&gt;% 
  write.csv(&quot;./datasets/trump1.csv&quot;)

read_csv(&quot;./datasets/hashtag_donaldtrump.csv&quot;) %&gt;% 
  drop_na() %&gt;%
  slice(-seq(0.5 * n())) %&gt;% 
  write.csv(&quot;./datasets/trump2.csv&quot;)
  
read_csv(&quot;./datasets/hashtag_joebiden.csv&quot;) %&gt;% 
  drop_na() %&gt;% 
  slice(seq(0.5 * n())) %&gt;% 
  write.csv(&quot;./datasets/biden1.csv&quot;)

read_csv(&quot;./datasets/hashtag_joebiden.csv&quot;) %&gt;% 
  drop_na() %&gt;% 
  slice(-seq(0.5 * n())) %&gt;% 
  write.csv(&quot;./datasets/biden2.csv&quot;)</code></pre>
<p>Then, data was imported, merged, and cleaned, especially date of creation of the tweet, for further analysis. We further limited our analysis to tweets from users registered within the U.S. and with only one of the cadidates hashtags (i.e.: we excluded tweets containing both #Trump/#DonaldTrump and #Biden/#joeBiden).</p>
<pre class="r"><code>#Trump / #DonaldTrump tweets
trump_df = 
  merge(
    read_csv(&quot;./datasets/trump1.csv&quot;),
    read_csv(&quot;./datasets/trump2.csv&quot;),
    all = TRUE
  ) %&gt;%
  select(!X1) %&gt;% 
  separate(created_at, into = c(&quot;creation_date&quot;, &quot;creation_time&quot;), sep = &quot; &quot;) %&gt;% 
  separate(creation_date, into = c(&quot;creation_year&quot;, &quot;creation_month&quot;, &quot;creation_day&quot;), sep = &quot;-&quot;) %&gt;% 
  separate(user_join_date, into = c(&quot;join_date&quot;, &quot;join_time&quot;), sep = &quot; &quot;) %&gt;% 
  separate(join_date, into = c(&quot;join_year&quot;, &quot;join_month&quot;, &quot;join_day&quot;), sep = &quot;-&quot;) %&gt;% 
  mutate(hashtag = &quot;Trump&quot;)

#Biden / #JoeBiden tweets
biden_df = 
  merge(
    read_csv(&quot;./datasets/biden1.csv&quot;),
    read_csv(&quot;./datasets/biden2.csv&quot;),
    all = TRUE
  ) %&gt;%
  select(!X1) %&gt;%  
  separate(created_at, into = c(&quot;creation_date&quot;, &quot;creation_time&quot;), sep = &quot; &quot;) %&gt;% 
  separate(creation_date, into = c(&quot;creation_year&quot;, &quot;creation_month&quot;, &quot;creation_day&quot;), sep = &quot;-&quot;) %&gt;% 
  separate(user_join_date, into = c(&quot;join_date&quot;, &quot;join_time&quot;), sep = &quot; &quot;) %&gt;% 
  separate(join_date, into = c(&quot;join_year&quot;, &quot;join_month&quot;, &quot;join_day&quot;), sep = &quot;-&quot;) %&gt;% 
  mutate(hashtag = &quot;Biden&quot;)

# Subset of USA tweets from US-registered users only
tweets_usa =     # N = 140263 tweets
  merge(biden_df, trump_df, all = TRUE) %&gt;% 
  filter(country == &quot;United States of America&quot;) %&gt;% 
  distinct(tweet, .keep_all = TRUE)   # N = 123635 (16628 tweets removed containing both hashtags)</code></pre>
<p>The final dataframe <code>tweets_usa</code> have 28 columns with the relevant variables used in this report as follows:</p>
<ul>
<li><code>creation_year</code>, <code>creation_month</code>,<code>creation_day</code>, and <code>creation_time</code>. Date and time of tweet creation.</li>
<li><code>tweet</code>. Full tweet text.</li>
<li><code>likes</code>. Number of likes.</li>
<li><code>retweet_count</code>. Number of retweets.</li>
<li><code>user_followers_count</code>. Followers count on user account at the time of tweet creation.</li>
<li><code>lat</code> and <code>long</code>. Latitude and longitude parsed from user location.</li>
<li><code>city</code>, <code>state</code>, and `state_code. City and state from user location.</li>
<li><code>hashtag</code>. Whether tweet contains #Biden or #Trump.</li>
</ul>
<p>Election stuff</p>
<pre class="r"><code>election_df =
  read_csv(&quot;./datasets/president_county_candidate.csv&quot;) %&gt;% 
  group_by(state, party) %&gt;% 
  mutate(party_total = sum(total_votes)) %&gt;% 
  ungroup() %&gt;% 
  group_by(state) %&gt;%
  mutate(state_winner = case_when(
                      party_total == max(party_total) ~ TRUE,
                      party_total != max(party_total) ~ FALSE),
         state_total = sum(total_votes)
  )

state_election_df = 
  election_df %&gt;% 
  filter(state_winner == TRUE) %&gt;% 
  select(state, candidate, party, party_total, state_total) %&gt;% 
  distinct()</code></pre>
<p>joining df</p>
<pre class="r"><code>main_tweets_usa = 
  left_join(tweets_usa, state_election_df, by = &quot;state&quot;) %&gt;% 
  rename(
    winner_candidate = candidate,
    winner_party = party
  )</code></pre>
</div>
<div id="plots" class="section level3">
<h3>Plots</h3>
<p>Characterizing tweets TODO : use the same colors</p>
<pre class="r"><code>tweets_usa %&gt;%
group_by(state, hashtag)%&gt;%
summarise(count = n()) %&gt;%  
ggplot() +
geom_col(aes(x=state, y=count, fill = hashtag ), position = &quot;dodge&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs (title = &quot;Distribution of tweets across US states&quot;)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;state&#39; (override with `.groups` argument)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>tweets_usa %&gt;% 
mutate(date = as.Date(paste(creation_month, creation_day, &#39;2020&#39;, sep = &quot;/&quot;), format  = &quot;%m/%d/%y&quot;)) %&gt;%  
group_by (date, hashtag) %&gt;%
summarise(count = n())  %&gt;%
ggplot(aes(x=date,y=count,color = hashtag)) +
geom_smooth(method = &quot;lm&quot;) +
geom_point(aes(x=date, y=count, color = hashtag)) +
geom_vline(xintercept = as.Date(&quot;2020-11-02&quot;)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_date(date_breaks = &#39;1 day&#39;) +
labs (title = &quot;Distribution of tweets over time&quot;, 
        x = &quot;Day&quot;,
        y = &quot;Number of tweets&quot;)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;date&#39; (override with `.groups` argument)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We see that there is an increase in tweets over time with Biden having less tweets overall (albeit not statistically significant)</p>
<pre class="r"><code>#tweets_usa %&gt;%
#select (user_followers_count) %&gt;%
#  arrange(desc(user_followers_count))

tweets_usa %&gt;%
group_by(hashtag)%&gt;%
filter (retweet_count&gt;0 &amp; likes&gt;0) %&gt;%
filter (user_followers_count&lt;=3750110) %&gt;%# filter outliers  
mutate(user_followers_count = user_followers_count/1000) %&gt;%
ggplot() +
geom_point(aes(x= user_followers_count , y= retweet_count, color = hashtag, size = likes  )) +
  labs (title = &quot;How tweets are shared and liked depending on the number of followers&quot;, 
        x = &quot;Numer of users, thousands&quot;,
        y = &quot;Number of retweets&quot;)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>usa_map &lt;- map_data(&quot;state&quot;)

tweet_map &lt;- tweets_usa %&gt;%
group_by(state, hashtag) %&gt;%
summarise(count = n(),
          likes = sum(likes)) %&gt;%  
mutate (likes_tweets = likes*count,
        region = tolower(state)) %&gt;%
select (region, hashtag, likes_tweets)  %&gt;%
pivot_wider(names_from = &quot;hashtag&quot;,
            values_from = &quot;likes_tweets&quot;)  %&gt;%
mutate(top = case_when(Biden&gt;coalesce(Trump,0) ~ &quot;Biden&quot;,
                       Trump&gt;Biden ~ &quot;Trump&quot;))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;state&#39; (override with `.groups` argument)</code></pre>
<pre><code>## Adding missing grouping variables: `state`</code></pre>
<pre class="r"><code>states_tweet_map &lt;- left_join(usa_map, tweet_map)</code></pre>
<pre><code>## Joining, by = &quot;region&quot;</code></pre>
<pre class="r"><code>    ggplot(data = states_tweet_map,
            aes(x = long, y = lat,
                group = group, fill = top)) +
    geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    labs(title =&quot;Most popular tweets across states&quot;)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>for NYC map over boroughs + plot them over map</p>
<pre class="r"><code>    NY &lt;-tweets_usa %&gt;% 
    filter (state_code == &#39;NY&#39; &amp; city == &#39;New York&#39;) %&gt;%
    filter (likes&gt;10 &amp; retweet_count&gt;10) %&gt;%
    select (lat, long, hashtag, likes, retweet_count)

r &lt;- GET(&#39;http://data.beta.nyc//dataset/0ff93d2d-90ba-457c-9f7e-39e47bf2ac5f/resource/35dd04fb-81b3-479b-a074-a27a37888ce7/download/d085e2f8d0b54d4590b1e7d1f35594c1pediacitiesnycneighborhoods.geojson&#39;)
nyc_neighborhoods &lt;- readOGR(content(r,&#39;text&#39;), &#39;OGRGeoJSON&#39;, verbose = F)

NY_points &lt;- NY
sp::coordinates(NY_points) &lt;- ~long + lat
proj4string(NY_points) &lt;- proj4string(nyc_neighborhoods)
matches &lt;- over(NY_points, nyc_neighborhoods)
points &lt;- cbind(NY, matches)
map_data &lt;- geo_join(nyc_neighborhoods, points, &quot;neighborhood&quot;, &quot;neighborhood&quot;)


leaflet(map_data) %&gt;%
  addTiles() %&gt;% 
  addPolygons(popup = ~hashtag) %&gt;% 
  addMarkers(~long, ~lat, popup = ~hashtag, data = points) %&gt;%
  addProviderTiles(&quot;CartoDB.Positron&quot;) %&gt;%
  setView(-75, 40.75, zoom = 10)</code></pre>
</div>
<div id="word-clouds" class="section level3">
<h3>Word Clouds</h3>
<p>We constructed an interactive shinyapp to display the most frequent words within tweets selected according to user-defined parameters in the form of word clouds. We used the <code>tm</code> package to clean tweet text of non-textual elements as well as stop words (both english and spanish). We developed a custom function <code>wordcount_df</code> that incorporates functions of this package and <em>tidyverse</em> elements to construct dataframes with a <code>word</code> and a <code>freq</code> column. This dataframe is the raw material for the <code>wordcloud2</code> package. It has several functionalities to create word clouds and with the <em>renderwordcloud2</em> function it can be incorporated into a <a href="wc_redirect.html">shinyapp©</a>.</p>
<p>Here is the code used to generate the app and a screenshot of the final product:</p>
<pre class="r"><code>if (require(shiny)) {
  
  library(tidyverse)
  library(flexdashboard)
  library(shiny)
  library(wordcloud2)
  library(tm)
  library(rsconnect)
  
  set.seed(1)

  trump_df = 
    merge(
      read_csv(&quot;./datasets/trump1.csv&quot;),
      read_csv(&quot;./datasets/trump2.csv&quot;),
      all = TRUE
    ) %&gt;%
    select(!X1) %&gt;%
    mutate(hashtag = &quot;Trump&quot;)
  
  biden_df = 
    merge(
      read_csv(&quot;./datasets/biden1.csv&quot;),
      read_csv(&quot;./datasets/biden2.csv&quot;),
      all = TRUE
    ) %&gt;%
    select(!X1) %&gt;%
    mutate(hashtag = &quot;Biden&quot;)
  
  tweets_usa =
    merge(biden_df, trump_df, all = TRUE) %&gt;% 
    filter(country == &quot;United States of America&quot;)
  
  election_df =
    read_csv(&quot;./datasets/president_county_candidate.csv&quot;) %&gt;% 
    group_by(state, party) %&gt;% 
    mutate(party_total = sum(total_votes)) %&gt;% 
    ungroup() %&gt;% 
    group_by(state) %&gt;%
    mutate(state_winner = case_when(
      party_total == max(party_total) ~ TRUE,
      party_total != max(party_total) ~ FALSE),
      state_total = sum(total_votes)
    )
  
  state_election_df = 
    election_df %&gt;% 
    filter(state_winner == TRUE) %&gt;% 
    select(state, candidate, party, party_total, state_total) %&gt;% 
    distinct()
  
  main_tweets_usa = 
    left_join(tweets_usa, state_election_df, by = &quot;state&quot;) %&gt;% 
    rename(
      winner_candidate = candidate,
      winner_party = party
    ) %&gt;% 
    select(tweet, hashtag, winner_party)

  wordcount_df = function(df) {
    
    if (!is.data.frame(df)) {
      stop(&quot;Input must be a dataframe&quot;)
    }
    
    df_text = 
      df %&gt;% 
      slice_head(n = 1000) %&gt;% 
      select(tweet) %&gt;%
      mutate(
        tweet = gsub(&quot;#[[:alpha:]]*&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;@[[:alpha:]]*&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;https\\S*&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;http\\S*&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;@\\S*&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;amp&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;[\r\n]&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;[0-9]&quot;, &quot;&quot;, tweet),
        tweet = gsub(&quot;[[:punct:]]&quot;, &quot;&quot;, tweet)
      )
    
    docs_df =
      Corpus(VectorSource(df_text)) %&gt;% 
      tm_map(removeNumbers) %&gt;%
      tm_map(removePunctuation) %&gt;%
      tm_map(stripWhitespace) %&gt;% 
      tm_map(content_transformer(tolower)) %&gt;% 
      tm_map(removeWords, stopwords(&quot;english&quot;)) %&gt;% 
      tm_map(removeWords, stopwords(&quot;spanish&quot;))
    
    words_df = 
      TermDocumentMatrix(docs_df) %&gt;% 
      as.matrix() %&gt;% 
      rowSums() %&gt;% 
      sort(decreasing = TRUE)
    
    word_count_df = data.frame(word = names(words_df),freq = words_df)
    
    return(word_count_df)
    
  }
  
  # Defining the UI
  
  ui =
    fluidPage(
    
      titlePanel(&quot;Election Tweets Explorer&quot;),
      
      sidebarPanel(
        
      radioButtons(
        &quot;Hashtag_choice&quot;,
        h4(&quot;Tweets containing...&quot;),
        inline = TRUE,
        choiceNames = list(&quot;#Biden/#JoeBiden&quot;, &quot;#Trump/#DonaldTrump&quot;, &quot;Either&quot;),
        choiceValues = list(&quot;Biden&quot;, &quot;Trump&quot;, &quot;Both&quot;),
        selected = &quot;Both&quot;
      ),
      
      radioButtons(
        &quot;Party_choice&quot;,
        h4(&quot;Tweets from states won by...&quot;),
        inline = TRUE,
        choiceNames = list(&quot;Democrats&quot;, &quot;Republicans&quot;, &quot;All States&quot;),
        choiceValues = list(&quot;DEM&quot;, &quot;REP&quot;, &quot;Both&quot;),
        selected = &quot;Both&quot;
      ),
      
      sliderInput(
        &quot;cut_top&quot;,
        h4(&quot;Number of words removed from top...&quot;),
        min = 0, max = 10,
        value = 3
      ),
      
      h6(&quot;*Most frequent words are common among various parameters&quot;),
      
      textInput(
        &quot;word&quot;, 
        h4(&quot;Tweets containing specific text:&quot;), 
        value = &quot;&quot;, 
        width = NULL, 
        placeholder = NULL)),
      
      mainPanel(wordcloud2Output(&#39;wordcloud2&#39;), width = 8)
    )
  
  
  # Defining the server code
  
  server = 
    function(input, output) {
    
      output$wordcloud2 &lt;- renderWordcloud2({
      
        if (input[[&quot;word&quot;]] == &quot;&quot;) {
      
            if (input[[&quot;Hashtag_choice&quot;]] == &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] == &quot;Both&quot;) {
      
                    main_tweets_usa %&gt;% 
                      wordcount_df() %&gt;% 
                      slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                      wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
      
            } else if (input[[&quot;Hashtag_choice&quot;]] != &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] != &quot;Both&quot;) {
      
                    main_tweets_usa %&gt;% 
                      filter(
                        hashtag == input[[&quot;Hashtag_choice&quot;]],
                        winner_party == input[[&quot;Party_choice&quot;]]
                      ) %&gt;% 
                      wordcount_df() %&gt;% 
                      slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                      wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
      
            } else if (input[[&quot;Hashtag_choice&quot;]] == &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] != &quot;Both&quot;) {
        
                       main_tweets_usa %&gt;% 
                         filter(
                           winner_party == input[[&quot;Party_choice&quot;]]
                         ) %&gt;% 
                         wordcount_df() %&gt;% 
                         slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                         wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
        
            } else if (input[[&quot;Hashtag_choice&quot;]] != &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] == &quot;Both&quot;) {
             
                        main_tweets_usa %&gt;% 
                          filter(
                            hashtag == input[[&quot;Hashtag_choice&quot;]]
                          ) %&gt;% 
                          wordcount_df() %&gt;% 
                          slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                          wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
             
        }
      
        } else {
      
            if (input[[&quot;Hashtag_choice&quot;]] == &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] == &quot;Both&quot;) {
              
                        main_tweets_usa %&gt;%
                         filter(str_detect(tweet, input[[&quot;word&quot;]])) %&gt;% 
                         wordcount_df() %&gt;% 
                         slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                         wordcloud2(size = 1, ellipticity = 1, color = &#39;random-dark&#39;)
              
            } else if (input[[&quot;Hashtag_choice&quot;]] != &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] != &quot;Both&quot;) {
              
                        main_tweets_usa %&gt;% 
                          filter(
                            str_detect(tweet, input[[&quot;word&quot;]]),
                            hashtag == input[[&quot;Hashtag_choice&quot;]],
                            winner_party == input[[&quot;Party_choice&quot;]]
                          ) %&gt;% 
                          wordcount_df() %&gt;% 
                          slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                          wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
              
            } else if (input[[&quot;Hashtag_choice&quot;]] == &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] != &quot;Both&quot;) {
              
                         main_tweets_usa %&gt;% 
                           filter(
                             str_detect(tweet, input[[&quot;word&quot;]]),
                             winner_party == input[[&quot;Party_choice&quot;]]
                           ) %&gt;% 
                           wordcount_df() %&gt;% 
                           slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                           wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
              
            } else if (input[[&quot;Hashtag_choice&quot;]] != &quot;Both&quot; &amp; input[[&quot;Party_choice&quot;]] == &quot;Both&quot;) {
              
                        main_tweets_usa %&gt;% 
                          filter(
                            str_detect(tweet, input[[&quot;word&quot;]]),
                            hashtag == input[[&quot;Hashtag_choice&quot;]]
                          ) %&gt;% 
                          wordcount_df() %&gt;% 
                          slice_tail(n = nrow(.) - input[[&quot;cut_top&quot;]]) %&gt;%
                          wordcloud2(size = 1, color = &#39;random-dark&#39;, ellipticity = 1)
        
            }
      
          }  
        })
      }

    shinyApp(ui = ui, server = server)
    
  }</code></pre>
<p><img src="figures/wordcloud.png" /></p>
<p>Users can explore tweet’s most frequent words by hashtag, by twitter user account original state’s winner party, or by specific text present within the tweet. Because the most frequent words are common among various selected parameters, we opted to allow users to remove a certain number of words from the top of the list. By doing so, it is possible to observe more sensitive differences among tweets.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
